<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–°å¢é£Ÿè°± - å°å°ç¾é£Ÿå®¶</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: #f8f9fa;
            line-height: 1.6;
        }

        /* å¤´éƒ¨æ ·å¼ */
        .add-header {
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            background: white;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        .back-btn {
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
            color: #333;
            padding: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.3rem;
        }

        /* æŒ‰é’®ç»„æ ·å¼ */
        .btn-group {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        /* æ”¶è—æŒ‰é’®æ ·å¼ï¼ˆå’Œä¿å­˜æŒ‰é’®åŒå½¢çŠ¶ï¼Œä¸åŒé¢œè‰²ï¼‰ */
        .favorite-btn {
            padding: 0.6rem 1.2rem;
            background: #FFD700;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.3s;
        }

        .favorite-btn.active {
            background: #d3c04c;
        }

        .favorite-btn:hover {
            background: #d3c04c;
        }

        .save-btn {
            padding: 0.6rem 1.2rem;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.3s;
        }

        .save-btn:hover {
            background: #c0392b;
        }

        /* è¡¨å•å®¹å™¨ */
        .add-container {
            padding: 1.5rem;
            max-width: 800px;
            margin: 0 auto;
        }

        /* è¡¨å•åˆ†ç»„æ ·å¼ */
        .form-group {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .form-title {
            font-size: 1.2rem;
            font-weight: bold;
            margin-bottom: 1.2rem;
            color: #333;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .form-title::before {
            content: '';
            width: 4px;
            height: 18px;
            background: #e74c3c;
            border-radius: 2px;
        }

        /* è¾“å…¥æ¡†æ ·å¼ */
        .form-input {
            width: 100%;
            padding: 0.9rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            margin-bottom: 1rem;
            transition: border 0.3s;
        }

        .form-input:focus {
            outline: none;
            border-color: #e74c3c;
        }

        /* é€‰æ‹©å™¨æ ·å¼ */
        .select-group {
            display: flex;
            gap: 1rem;
            flex-wrap: wrap;
            margin-bottom: 1rem;
        }

        .form-select {
            flex: 1;
            min-width: 120px;
            padding: 0.9rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 1rem;
            background: white;
            transition: border 0.3s;
        }

        .form-select:focus {
            outline: none;
            border-color: #e74c3c;
        }

        /* æ ‡ç­¾/é£Ÿæ/æ­¥éª¤åˆ—è¡¨æ ·å¼ */
        .list-container {
            margin-bottom: 1rem;
        }

        .list-item {
            display: flex;
            gap: 0.8rem;
            align-items: center;
            margin-bottom: 0.8rem;
            flex-wrap: wrap;
        }

        .list-input {
            flex: 1;
            min-width: 200px;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 0.95rem;
        }

        .amount-input {
            width: 120px;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 0.95rem;
            text-align: center;
        }

        .step-input {
            flex: 1;
            min-width: 250px;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 0.95rem;
        }

        .add-btn {
            padding: 0.8rem 1rem;
            background: #f1f1f1;
            border: 1px solid #ddd;
            border-radius: 8px;
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.2s;
            width: 100%;
            margin-top: 0.5rem;
        }

        .add-btn:hover {
            background: #e9e9e9;
        }

        /* åˆ é™¤æŒ‰é’®æ ·å¼ï¼ˆæ”¹ä¸ºæ–‡å­—æŒ‰é’®ï¼‰ */
        .remove-btn {
            padding: 0.8rem 1rem;
            background: #ffeaea;
            border: 1px solid #ffcccc;
            border-radius: 8px;
            color: #e74c3c;
            cursor: pointer;
            font-size: 0.95rem;
            transition: all 0.2s;
            white-space: nowrap;
            min-width: 80px;
        }

        .remove-btn:hover {
            background: #ffcccc;
        }

        .remove-btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            background: #f8f8f8;
            border-color: #eee;
            color: #999;
        }

        /* æ–‡æœ¬åŸŸæ ·å¼ */
        .form-textarea {
            width: 100%;
            padding: 0.9rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 0.95rem;
            min-height: 100px;
            resize: vertical;
            line-height: 1.6;
            transition: border 0.3s;
        }

        .form-textarea:focus {
            outline: none;
            border-color: #e74c3c;
        }

        /* è¥å…»ä¿¡æ¯æ ·å¼ */
        .nutrition-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .nutrition-item {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .nutrition-label {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 0.95rem;
            background: #f8f9fa;
            text-align: center;
        }

        .nutrition-value {
            width: 100%;
            padding: 0.8rem;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 0.95rem;
        }

        /* æç¤ºæ–‡æœ¬ */
        .hint-text {
            font-size: 0.85rem;
            color: #888;
            margin-top: -0.8rem;
            margin-bottom: 1rem;
            display: block;
        }

        /* å¿…å¡«é¡¹æç¤º */
        .required-hint {
            color: #e74c3c;
            font-size: 0.85rem;
            margin-top: -0.5rem;
            margin-bottom: 1rem;
            display: block;
        }

        /* å“åº”å¼è®¾è®¡ */
        @media (max-width: 768px) {
            .add-container {
                padding: 1rem;
            }

            .form-group {
                padding: 1rem;
            }

            .select-group {
                flex-direction: column;
            }

            .form-select {
                min-width: 100%;
            }

            .list-item {
                flex-direction: column;
                align-items: stretch;
            }

            .list-input, .amount-input, .step-input {
                width: 100%;
                min-width: auto;
            }

            .remove-btn {
                width: 100%;
            }

            .nutrition-list {
                grid-template-columns: 1fr;
            }
        }

        @media (max-width: 480px) {
            .add-header {
                flex-direction: column;
                gap: 1rem;
            }

            .btn-group {
                width: 100%;
                justify-content: space-between;
            }

            .favorite-btn, .save-btn {
                flex: 1;
            }
        }
    </style>
</head>
<body>
<!-- å¤´éƒ¨ -->
<div class="add-header">
    <button class="back-btn" onclick="goBack()">â† è¿”å›</button>
    <div class="btn-group">
        <button class="favorite-btn" id="favoriteBtn" onclick="toggleFavorite()">ä¸€é”®æ”¶è—</button>
        <button class="save-btn" onclick="submitRecipe()">ä¿å­˜èœè°±</button>
    </div>
</div>

<!-- è¡¨å•å®¹å™¨ -->
<div class="add-container">
    <!-- åŸºæœ¬ä¿¡æ¯ï¼ˆå¿…å¡«ï¼‰ -->
    <div class="form-group">
        <h2 class="form-title">åŸºæœ¬ä¿¡æ¯ <span style="color:#e74c3c; font-weight:normal; font-size:0.9rem;">ï¼ˆå¿…å¡«ï¼‰</span></h2>
        <input type="text" class="form-input" id="recipeName" placeholder="è¯·è¾“å…¥èœè°±åç§°ï¼ˆå¦‚ï¼šç•ªèŒ„ç‚’è›‹ï¼‰" required>

        <div class="select-group">
            <select class="form-select" id="recipeCategory" required>
                <option value="">é€‰æ‹©åˆ†ç±»</option>
                <option value="æ­£é¤">æ­£é¤</option>
                <option value="ç”œç‚¹">ç”œç‚¹</option>
                <option value="æ—©é¤">æ—©é¤</option>
                <option value="æ±¤ç¾¹">æ±¤ç¾¹</option>
            </select>
            <select class="form-select" id="recipeDifficulty" required>
                <option value="">é€‰æ‹©éš¾åº¦</option>
                <option value="â­ ç®€å•">ç®€å•</option>
                <option value="â­â­ ä¸­ç­‰">ä¸­ç­‰</option>
                <option value="â­â­â­ å›°éš¾">å›°éš¾</option>
            </select>
            <input type="number" class="form-input" id="recipeTime" placeholder="çƒ¹é¥ªæ—¶é—´ï¼ˆåˆ†é’Ÿï¼‰" min="1" required>
        </div>
    </div>

    <!-- é£Ÿæå‡†å¤‡ï¼ˆå¿…å¡«ï¼‰ -->
    <div class="form-group">
        <h2 class="form-title">é£Ÿæå‡†å¤‡ <span style="color:#e74c3c; font-weight:normal; font-size:0.9rem;">ï¼ˆå¿…å¡«ï¼‰</span></h2>
        <p class="hint-text">ç‚¹å‡»ã€Œ+ æ·»åŠ é£Ÿæã€å¯æ·»åŠ å¤šä¸ªé£Ÿæï¼Œå¡«å†™é£Ÿæåç§°å’Œç”¨é‡</p>
        <div class="list-container" id="ingredientsContainer">
            <div class="list-item">
                <input type="text" class="list-input" placeholder="é£Ÿæåç§°ï¼ˆå¦‚ï¼šç•ªèŒ„ï¼‰" required>
                <input type="text" class="amount-input" placeholder="ç”¨é‡ï¼ˆå¦‚ï¼š2ä¸ªï¼‰" required>
                <button class="remove-btn" onclick="removeItem(this)" disabled>åˆ é™¤</button>
            </div>
        </div>
        <button class="add-btn" onclick="addIngredient()">+ æ·»åŠ é£Ÿæ</button>
    </div>

    <!-- çƒ¹é¥ªæ­¥éª¤ï¼ˆå¿…å¡«ï¼‰ -->
    <div class="form-group">
        <h2 class="form-title">çƒ¹é¥ªæ­¥éª¤ <span style="color:#e74c3c; font-weight:normal; font-size:0.9rem;">ï¼ˆå¿…å¡«ï¼‰</span></h2>
        <p class="hint-text">ç‚¹å‡»ã€Œ+ æ·»åŠ æ­¥éª¤ã€å¯æ·»åŠ å¤šä¸ªæ­¥éª¤ï¼ŒæŒ‰é¡ºåºå¡«å†™</p>
        <div class="list-container" id="stepsContainer">
            <div class="list-item">
                <input type="text" class="step-input" placeholder="æ­¥éª¤ 1ï¼ˆå¦‚ï¼šç•ªèŒ„æ´—å‡€åˆ‡å—ï¼‰" required>
                <button class="remove-btn" onclick="removeItem(this)" disabled>åˆ é™¤</button>
            </div>
        </div>
        <button class="add-btn" onclick="addStep()">+ æ·»åŠ æ­¥éª¤</button>
    </div>

    <!-- å°è´´å£«ï¼ˆå¯é€‰ï¼‰ -->
    <div class="form-group">
        <h2 class="form-title">çƒ¹é¥ªå°è´´å£« <span style="color:#888; font-weight:normal; font-size:0.9rem;">ï¼ˆå¯é€‰ï¼‰</span></h2>
        <textarea class="form-textarea" id="recipeTips" placeholder="å¡«å†™çƒ¹é¥ªæŠ€å·§ã€æ³¨æ„äº‹é¡¹ç­‰ï¼ˆå¯é€‰ï¼‰"></textarea>
    </div>

    <!-- è¥å…»ä¿¡æ¯ï¼ˆå¯é€‰ï¼‰ -->
    <div class="form-group">
        <h2 class="form-title">è¥å…»ä¿¡æ¯ <span style="color:#888; font-weight:normal; font-size:0.9rem;">ï¼ˆå¯é€‰ï¼‰</span></h2>
        <div class="nutrition-list">
            <div class="nutrition-item">
                <div class="nutrition-label">çƒ­é‡</div>
                <input type="text" class="nutrition-value" placeholder="å¦‚ï¼š280å¤§å¡">
            </div>
            <div class="nutrition-item">
                <div class="nutrition-label">è›‹ç™½è´¨</div>
                <input type="text" class="nutrition-value" placeholder="å¦‚ï¼š18g">
            </div>
            <div class="nutrition-item">
                <div class="nutrition-label">ç»´ç”Ÿç´ </div>
                <input type="text" class="nutrition-value" placeholder="å¦‚ï¼šå¯Œå«ç»´ç”Ÿç´ C">
            </div>
        </div>
    </div>
</div>

<script>
    let isFavorite = false; // é»˜è®¤æœªæ”¶è—

    // è¿”å›åˆ—è¡¨é¡µ
    function goBack() {
        if (confirm('æ˜¯å¦æ”¾å¼ƒä¿å­˜ï¼Ÿå·²å¡«å†™çš„å†…å®¹å°†ä¸ä¼šä¿ç•™')) {
            window.location.href = 'æˆ‘çš„é£Ÿè°±.html';
        }
    }

    // åˆ‡æ¢æ”¶è—çŠ¶æ€
    function toggleFavorite() {
        isFavorite = !isFavorite;
        const favoriteBtn = document.getElementById('favoriteBtn');
        favoriteBtn.classList.toggle('active', isFavorite);

        // æ›´æ–°æŒ‰é’®æ–‡æœ¬æç¤º
        favoriteBtn.textContent = isFavorite ? 'å·²æ”¶è—' : 'ä¸€é”®æ”¶è—';
        alert(isFavorite ? 'å·²æ·»åŠ åˆ°æ”¶è—å¤¹ï¼' : 'å·²å–æ¶ˆæ”¶è—');
    }

    // æ·»åŠ é£Ÿæ
    function addIngredient() {
        const container = document.getElementById('ingredientsContainer');
        const itemCount = container.children.length;

        const newItem = document.createElement('div');
        newItem.className = 'list-item';
        newItem.innerHTML = `
            <input type="text" class="list-input" placeholder="é£Ÿæåç§°ï¼ˆå¦‚ï¼šé¸¡è›‹ï¼‰" required>
            <input type="text" class="amount-input" placeholder="ç”¨é‡ï¼ˆå¦‚ï¼š3ä¸ªï¼‰" required>
            <button class="remove-btn" onclick="removeItem(this)">åˆ é™¤</button>
        `;

        container.appendChild(newItem);

        // å¯ç”¨æ‰€æœ‰åˆ é™¤æŒ‰é’®ï¼ˆåªå‰©ä¸€é¡¹æ—¶ç¦ç”¨ï¼‰
        container.querySelectorAll('.remove-btn').forEach(btn => {
            btn.disabled = container.children.length <= 1;
        });
    }

    // æ·»åŠ æ­¥éª¤
    function addStep() {
        const container = document.getElementById('stepsContainer');
        const itemCount = container.children.length;

        const newItem = document.createElement('div');
        newItem.className = 'list-item';
        newItem.innerHTML = `
            <input type="text" class="step-input" placeholder="æ­¥éª¤ ${itemCount + 1}ï¼ˆå¦‚ï¼šé”…ä¸­å€’æ²¹çƒ§çƒ­ï¼‰" required>
            <button class="remove-btn" onclick="removeItem(this)">åˆ é™¤</button>
        `;

        container.appendChild(newItem);

        // å¯ç”¨æ‰€æœ‰åˆ é™¤æŒ‰é’®ï¼ˆåªå‰©ä¸€é¡¹æ—¶ç¦ç”¨ï¼‰
        container.querySelectorAll('.remove-btn').forEach(btn => {
            btn.disabled = container.children.length <= 1;
        });
    }

    // åˆ é™¤é¡¹ï¼ˆé£Ÿæ/æ­¥éª¤ï¼‰- æ¸…ç©ºè¯¥è¡Œå¹¶åˆ é™¤
    function removeItem(btn) {
        const item = btn.parentElement;
        const container = item.parentElement;

        // æ¸…ç©ºè¯¥è¡Œè¾“å…¥æ¡†å†…å®¹
        const inputs = item.querySelectorAll('input');
        inputs.forEach(input => {
            input.value = '';
        });

        // åˆ é™¤è¯¥è¡Œå…ƒç´ 
        setTimeout(() => {
            container.removeChild(item);

            // æ›´æ–°æ­¥éª¤åºå·
            if (container.id === 'stepsContainer') {
                container.querySelectorAll('.list-item').forEach((item, index) => {
                    item.querySelector('input').placeholder = `æ­¥éª¤ ${index + 1}ï¼ˆå¦‚ï¼šé”…ä¸­å€’æ²¹çƒ§çƒ­ï¼‰`;
                });
            }

            // ç¦ç”¨åˆ é™¤æŒ‰é’®ï¼ˆå½“åªå‰©ä¸€é¡¹æ—¶ï¼‰
            container.querySelectorAll('.remove-btn').forEach(btn => {
                btn.disabled = container.children.length <= 1;
            });
        }, 100); // çŸ­æš‚å»¶è¿Ÿè®©ç”¨æˆ·çœ‹åˆ°æ¸…ç©ºæ•ˆæœ
    }

    // è·å–åˆ†ç±»å¯¹åº”çš„emoji
    function getEmojiByCategory(category) {
        const emojiMap = {
            'æ­£é¤': 'ğŸ³',
            'ç”œç‚¹': 'ğŸ°',
            'æ—©é¤': 'ğŸ',
            'æ±¤ç¾¹': 'ğŸ¥£'
        };
        return emojiMap[category] || 'ğŸ½ï¸';
    }

    // æäº¤èœè°±
    function submitRecipe() {
        // 1. éªŒè¯åŸºæœ¬ä¿¡æ¯ï¼ˆå¿…å¡«ï¼‰
        const recipeName = document.getElementById('recipeName').value.trim();
        const category = document.getElementById('recipeCategory').value;
        const difficulty = document.getElementById('recipeDifficulty').value;
        const time = document.getElementById('recipeTime').value.trim();

        if (!recipeName) {
            alert('è¯·å¡«å†™èœè°±åç§°ï¼');
            document.getElementById('recipeName').focus();
            return;
        }
        if (!category) {
            alert('è¯·é€‰æ‹©èœè°±åˆ†ç±»ï¼');
            document.getElementById('recipeCategory').focus();
            return;
        }
        if (!difficulty) {
            alert('è¯·é€‰æ‹©èœè°±éš¾åº¦ï¼');
            document.getElementById('recipeDifficulty').focus();
            return;
        }
        if (!time || isNaN(time) || time < 1) {
            alert('è¯·å¡«å†™æœ‰æ•ˆçš„çƒ¹é¥ªæ—¶é—´ï¼ˆè‡³å°‘1åˆ†é’Ÿï¼‰ï¼');
            document.getElementById('recipeTime').focus();
            return;
        }

        // 2. éªŒè¯é£Ÿæï¼ˆå¿…å¡«ï¼Œè‡³å°‘ä¸€é¡¹ä¸”å†…å®¹ä¸èƒ½ä¸ºç©ºï¼‰
        const ingredients = [];
        let hasValidIngredient = false;
        document.querySelectorAll('#ingredientsContainer .list-item').forEach(item => {
            const name = item.querySelector('.list-input').value.trim();
            const amount = item.querySelector('.amount-input').value.trim();
            if (name && amount) {
                ingredients.push({ name, amount });
                hasValidIngredient = true;
            }
        });

        if (!hasValidIngredient) {
            alert('è¯·è‡³å°‘å¡«å†™ä¸€ç§é£Ÿæåç§°å’Œç”¨é‡ï¼');
            document.querySelector('#ingredientsContainer .list-input').focus();
            return;
        }

        // 3. éªŒè¯æ­¥éª¤ï¼ˆå¿…å¡«ï¼Œè‡³å°‘ä¸€é¡¹ä¸”å†…å®¹ä¸èƒ½ä¸ºç©ºï¼‰
        const steps = [];
        let hasValidStep = false;
        document.querySelectorAll('#stepsContainer .list-item').forEach(item => {
            const content = item.querySelector('.step-input').value.trim();
            if (content) {
                steps.push(content);
                hasValidStep = true;
            }
        });

        if (!hasValidStep) {
            alert('è¯·è‡³å°‘å¡«å†™ä¸€ä¸ªçƒ¹é¥ªæ­¥éª¤ï¼');
            document.querySelector('#stepsContainer .step-input').focus();
            return;
        }

        // 4. æ”¶é›†å¯é€‰ä¿¡æ¯
        const tips = document.getElementById('recipeTips').value.trim();
        const nutrition = [];
        document.querySelectorAll('.nutrition-item').forEach(item => {
            const label = item.querySelector('.nutrition-label').textContent;
            const value = item.querySelector('.nutrition-value').value.trim();
            if (value) {
                nutrition.push({ label, value });
            }
        });

        // 5. æ„å»ºèœè°±æ•°æ®
        const newRecipe = {
            id: Date.now(), // å”¯ä¸€ID
            name: recipeName,
            type: category,
            difficulty: difficulty,
            time: `${time}åˆ†é’Ÿ`,
            image: getEmojiByCategory(category) + ' ' + recipeName,
            ingredients: ingredients,
            steps: steps,
            tips: tips,
            nutrition: nutrition,
            isFavorite: isFavorite,
            createTime: new Date().toLocaleString()
        };

        // 6. ä¿å­˜åˆ°æœ¬åœ°å­˜å‚¨ï¼ˆå®é™…é¡¹ç›®å¯æ›¿æ¢ä¸ºæ¥å£è¯·æ±‚ï¼‰
        let recipes = JSON.parse(localStorage.getItem('recipes') || '[]');
        recipes.push(newRecipe);
        localStorage.setItem('recipes', JSON.stringify(recipes));

        // 7. æç¤ºå¹¶è·³è½¬
        alert(`èœè°±ã€Œ${recipeName}ã€ä¿å­˜æˆåŠŸï¼${isFavorite ? 'å·²æ·»åŠ åˆ°æ”¶è—å¤¹' : ''}`);
        window.location.href = 'æˆ‘çš„é£Ÿè°±.html';
    }
</script>
</body>
</html>