<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>åƒä»€ä¹ˆ - å°å°ç¾é£Ÿå®¶</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            background: #f8f9fa;
        }

        .navbar {
            background: white;
            padding: 1rem;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }

        .nav-tabs {
            display: flex;
            justify-content: space-around;
            list-style: none;
        }

        .nav-tabs li {
            padding: 0.5rem 1rem;
            cursor: pointer;
            border-bottom: 2px solid transparent;
        }

        .nav-tabs li.active {
            border-bottom: 2px solid #e74c3c;
            color: #e74c3c;
        }

        .container {
            padding: 1rem;
        }

        .mode-selector {
            background: white;
            padding: 1.5rem;
            border-radius: 12px;
            margin-bottom: 1rem;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        /* é‡æ„ä¸ºä¸‰ä¸ªæ¨¡å¼çš„åˆ‡æ¢æ ·å¼ */
        .mode-toggle {
            display: flex;
            background: #f8f9fa;
            border-radius: 25px;
            padding: 0.3rem;
            position: relative;
            margin-bottom: 1rem;
        }

        .mode-option {
            flex: 1;
            text-align: center;
            padding: 0.8rem;
            cursor: pointer;
            z-index: 1;
            transition: color 0.3s;
            font-size: 0.9rem;
        }

        .mode-option.active {
            color: white;
        }

        /* é€‚é…ä¸‰ä¸ªæ¨¡å¼çš„æ»‘å—æ ·å¼ */
        .slider {
            position: absolute;
            top: 0.3rem;
            left: 0.3rem;
            width: calc(33.333% - 0.3rem);
            height: calc(100% - 0.6rem);
            background: #e74c3c;
            border-radius: 20px;
            transition: transform 0.3s ease;
        }

        .mode-description {
            text-align: center;
            color: #666;
            font-size: 0.9rem;
        }

        .scenario-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin-top: 1rem;
        }

        .scenario-btn {
            padding: 0.5rem 1rem;
            border: 1px solid #ddd;
            border-radius: 20px;
            background: white;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        .scenario-btn.active {
            background: #e74c3c;
            color: white;
            border-color: #e74c3c;
        }

        /* æƒŠå–œæ¨¡å¼ç­›é€‰æ ‡ç­¾æ ·å¼ï¼ˆæ”¯æŒå¤šé€‰ï¼‰ */
        .surprise-filters {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .surprise-tag {
            padding: 0.5rem 1rem;
            border: 1px solid #ddd;
            border-radius: 20px;
            background: white;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.2s;
        }

        .surprise-tag.selected {
            background: #9b59b6;
            color: white;
            border-color: #9b59b6;
        }

        .sort-options {
            display: flex;
            gap: 1rem;
            margin: 1rem 0;
        }

        .sort-btn {
            padding: 0.5rem 1rem;
            border: 1px solid #ddd;
            border-radius: 20px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
        }

        .sort-btn.active {
            background: #3498db;
            color: white;
            border-color: #3498db;
        }

        /* ç¦ç”¨çš„æ’åºæŒ‰é’®æ ·å¼ */
        .sort-btn.disabled {
            opacity: 0.5;
            cursor: not-allowed;
            pointer-events: none;
        }

        .recommendations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
        }

        .recipe-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            transition: transform 0.3s;
            cursor: pointer;
            position: relative;
        }

        .recipe-card:hover {
            transform: translateY(-5px);
        }

        .match-badge {
            position: absolute;
            top: 1rem;
            right: 1rem;
            padding: 0.3rem 0.8rem;
            border-radius: 12px;
            font-size: 0.8rem;
            font-weight: bold;
            z-index: 2;
        }

        .perfect-match {
            background: #2ecc71;
            color: white;
        }

        .partial-match {
            background: #f39c12;
            color: white;
        }

        .surprise-match {
            background: #9b59b6;
            color: white;
        }

        .recipe-image {
            width: 100%;
            height: 160px;
            background: #ddd;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #666;
            position: relative;
        }

        .recipe-content {
            padding: 1rem;
        }

        .recipe-title {
            font-size: 1.1rem;
            font-weight: bold;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        /* åˆ†ç±»æ ‡ç­¾æ ·å¼ */
        .category-tag {
            font-size: 0.7rem;
            color: #888;
            background: #f1f1f1;
            padding: 0.1rem 0.5rem;
            border-radius: 10px;
            font-weight: normal;
        }

        .recipe-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.3rem;
            margin-bottom: 0.5rem;
        }

        .tag {
            background: #f1f1f1;
            padding: 0.2rem 0.6rem;
            border-radius: 12px;
            font-size: 0.8rem;
            color: #666;
        }

        .missing-ingredients {
            background: #ffeaea;
            padding: 0.5rem;
            border-radius: 6px;
            margin: 0.5rem 0;
            font-size: 0.8rem;
        }

        .missing-ingredients .title {
            font-weight: bold;
            color: #e74c3c;
            margin-bottom: 0.3rem;
        }

        .missing-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.3rem;
        }

        .missing-tag {
            background: #ffcccc;
            padding: 0.2rem 0.5rem;
            border-radius: 10px;
            font-size: 0.7rem;
            color: #c0392b;
        }

        .recipe-meta {
            display: flex;
            justify-content: space-between;
            font-size: 0.8rem;
            color: #888;
            margin-bottom: 0.8rem;
        }

        /* æŸ¥çœ‹èœè°±æŒ‰é’®æ ·å¼ */
        .view-btn {
            width: 100%;
            padding: 0.8rem;
            background: #e74c3c;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1rem;
            transition: background 0.3s;
        }

        .view-btn:hover {
            background: #c0392b;
        }

        .empty-state {
            text-align: center;
            padding: 3rem;
            color: #666;
        }

        .surprise-btn {
            width: 100%;
            padding: 1rem;
            background: #9b59b6;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 1.1rem;
            margin-top: 1rem;
            transition: background 0.3s;
            display: none; /* æƒŠå–œæ¨¡å¼æ•´åˆåˆ°é¡¶éƒ¨åˆ‡æ¢ï¼Œéšè—åº•éƒ¨æŒ‰é’® */
        }

        .surprise-btn:hover {
            background: #8e44ad;
        }
    </style>
</head>
<body>
<nav class="navbar">
    <ul class="nav-tabs">
        <li onclick="window.location.href='æˆ‘çš„é£Ÿè°±.html'">æˆ‘çš„é£Ÿè°±</li>
        <li onclick="window.location.href='æˆ‘çš„å†°ç®±.html'">æˆ‘çš„å†°ç®±</li>
        <li class="active" onclick="window.location.href='åƒä»€ä¹ˆ.html'">åƒä»€ä¹ˆ</li>
        <li onclick="window.location.href='æˆ‘çš„.html'">æˆ‘çš„</li>
    </ul>
</nav>

<div class="container">
    <div class="mode-selector">
        <div class="mode-toggle">
            <div class="slider" id="modeSlider"></div>
            <!-- æ”¹ä¸ºä¸‰ä¸ªæ¨¡å¼é€‰é¡¹ -->
            <div class="mode-option active" onclick="switchMode('strict')">ç²¾å‡†æ¨¡å¼</div>
            <div class="mode-option" onclick="switchMode('flexible')">åˆ›æ„æ¨¡å¼</div>
            <div class="mode-option" onclick="switchMode('surprise')">æ¥ä¸ªæƒŠå–œ</div>
        </div>
        <div class="mode-description" id="modeDescription">
            ä¸å°†å°±ï¼Œç¼ºä¸€ä¸å¯ï¼ˆæ‰€æœ‰èœè°±åŒ¹é…åº¦100%ï¼‰
        </div>

        <!-- åˆ†ç±»æ”¹ä¸ºï¼šå…¨éƒ¨ã€æ­£é¤ã€ç”œç‚¹ã€æ—©é¤ã€æ±¤ç¾¹ï¼ˆå’Œæˆ‘çš„é£Ÿè°±é¡µåŒ¹é…ï¼‰ -->
        <div class="scenario-filters">
            <button class="scenario-btn active" onclick="toggleScenario(this)">å…¨éƒ¨</button>
            <button class="scenario-btn" onclick="toggleScenario(this)">æ­£é¤</button>
            <button class="scenario-btn" onclick="toggleScenario(this)">ç”œç‚¹</button>
            <button class="scenario-btn" onclick="toggleScenario(this)">æ—©é¤</button>
            <button class="scenario-btn" onclick="toggleScenario(this)">æ±¤ç¾¹</button>
        </div>

        <!-- æƒŠå–œæ¨¡å¼ä¸“å±ç­›é€‰æ ‡ç­¾ï¼ˆç®€å•ç‚¹ã€å¿«é€Ÿã€é«˜åŒ¹é…ï¼‰ -->
        <div class="surprise-filters" id="surpriseFilters" style="display: none;">
            <button class="surprise-tag" onclick="toggleSurpriseTag(this)">ç®€å•ç‚¹</button>
            <button class="surprise-tag" onclick="toggleSurpriseTag(this)">å¿«é€Ÿ</button>
            <button class="surprise-tag" onclick="toggleSurpriseTag(this)">é«˜åŒ¹é…</button>
        </div>

        <div class="sort-options" id="sortOptions">
            <button class="sort-btn" id="sortMatch" onclick="toggleSort(this)">åŒ¹é…åº¦</button>
            <button class="sort-btn active" id="sortTime" onclick="toggleSort(this)">çƒ¹é¥ªæ—¶é—´</button>
            <button class="sort-btn" id="sortDifficulty" onclick="toggleSort(this)">éš¾åº¦</button>
        </div>
    </div>

    <div class="recommendations-grid" id="recommendationGrid">
        <!-- ç²¾å‡†æ¨¡å¼é»˜è®¤å†…å®¹ï¼ˆå…¨éƒ¨100%åŒ¹é…ï¼‰ -->
        <div class="recipe-card" onclick="openRecipeDetail('ç•ªèŒ„ç‚’è›‹')">
            <div class="match-badge perfect-match">100%åŒ¹é…</div>
            <div class="recipe-image">ğŸ³ ç•ªèŒ„ç‚’è›‹</div>
            <div class="recipe-content">
                <div class="recipe-title">ç•ªèŒ„ç‚’è›‹ <span class="category-tag">æ­£é¤</span></div>
                <div class="recipe-tags">
                    <span class="tag">ç•ªèŒ„</span>
                    <span class="tag">é¸¡è›‹</span>
                    <span class="tag">å°è‘±</span>
                </div>
                <div class="recipe-meta">
                    <span>â±ï¸ 15åˆ†é’Ÿ</span>
                    <span>â­ ç®€å•</span>
                </div>
                <button class="view-btn" onclick="openRecipeDetail('ç•ªèŒ„ç‚’è›‹', event)">æŸ¥çœ‹èœè°±</button>
            </div>
        </div>

        <div class="recipe-card" onclick="openRecipeDetail('åœŸè±†ä¸ç‚’è‚‰')">
            <div class="match-badge perfect-match">100%åŒ¹é…</div>
            <div class="recipe-image">ğŸ¥” åœŸè±†ä¸ç‚’è‚‰</div>
            <div class="recipe-content">
                <div class="recipe-title">åœŸè±†ä¸ç‚’è‚‰ <span class="category-tag">æ­£é¤</span></div>
                <div class="recipe-tags">
                    <span class="tag">åœŸè±†</span>
                    <span class="tag">çŒªè‚‰</span>
                    <span class="tag">è¾£æ¤’</span>
                </div>
                <div class="recipe-meta">
                    <span>â±ï¸ 20åˆ†é’Ÿ</span>
                    <span>â­ ç®€å•</span>
                </div>
                <button class="view-btn" onclick="openRecipeDetail('åœŸè±†ä¸ç‚’è‚‰', event)">æŸ¥çœ‹èœè°±</button>
            </div>
        </div>

        <div class="recipe-card" onclick="openRecipeDetail('æ¸…ç‚’é¸¡èƒ¸è‚‰')">
            <div class="match-badge perfect-match">100%åŒ¹é…</div>
            <div class="recipe-image">ğŸ— æ¸…ç‚’é¸¡èƒ¸è‚‰</div>
            <div class="recipe-content">
                <div class="recipe-title">æ¸…ç‚’é¸¡èƒ¸è‚‰ <span class="category-tag">æ­£é¤</span></div>
                <div class="recipe-tags">
                    <span class="tag">é¸¡èƒ¸è‚‰</span>
                    <span class="tag">é’æ¤’</span>
                    <span class="tag">ç”Ÿå§œ</span>
                </div>
                <div class="recipe-meta">
                    <span>â±ï¸ 18åˆ†é’Ÿ</span>
                    <span>â­â­ ä¸­ç­‰</span>
                </div>
                <button class="view-btn" onclick="openRecipeDetail('æ¸…ç‚’é¸¡èƒ¸è‚‰', event)">æŸ¥çœ‹èœè°±</button>
            </div>
        </div>
    </div>

    <button class="surprise-btn" id="surpriseBtn" onclick="surpriseMe()">
        ğŸ² éšä¾¿æ¥ä¸ªæƒŠå–œï¼
    </button>
</div>

<script>
    let currentMode = 'strict'; // é»˜è®¤ç²¾å‡†æ¨¡å¼ï¼ˆåŒ¹é…æ¨¡å¼ï¼‰
    let currentSort = 'çƒ¹é¥ªæ—¶é—´';   // é»˜è®¤æ’åºä¸ºçƒ¹é¥ªæ—¶é—´
    let currentScenario = 'å…¨éƒ¨';
    let selectedSurpriseTags = []; // æƒŠå–œæ¨¡å¼é€‰ä¸­çš„æ ‡ç­¾ï¼ˆç®€å•ç‚¹ã€å¿«é€Ÿã€é«˜åŒ¹é…ï¼‰

    // åˆå§‹åŒ–
    document.addEventListener('DOMContentLoaded', function() {
        // å¼ºåˆ¶æ¿€æ´»ç²¾å‡†æ¨¡å¼å’Œçƒ¹é¥ªæ—¶é—´æ’åº
        updateModeUI();
        updateRecommendations();
    });

    // åˆ‡æ¢æ¨¡å¼æ ¸å¿ƒå‡½æ•°
    function switchMode(mode) {
        currentMode = mode;
        currentScenario = document.querySelector('.scenario-btn.active').textContent;
        selectedSurpriseTags = []; // åˆ‡æ¢æ¨¡å¼æ¸…ç©ºæƒŠå–œæ ‡ç­¾é€‰ä¸­çŠ¶æ€

        // æ›´æ–°æ¨¡å¼UIå’Œæ’åºæŒ‰é’®çŠ¶æ€
        updateModeUI();
        // æ›´æ–°æ¨èå†…å®¹
        updateRecommendations();
    }

    // æ›´æ–°æ¨¡å¼ç›¸å…³UIï¼ˆæ»‘å—ã€æè¿°ã€æ’åºæŒ‰é’®ã€æƒŠå–œæ ‡ç­¾ï¼‰
    function updateModeUI() {
        const slider = document.getElementById('modeSlider');
        const options = document.querySelectorAll('.mode-option');
        const description = document.getElementById('modeDescription');
        const sortMatch = document.getElementById('sortMatch');
        const sortTime = document.getElementById('sortTime');
        const sortDifficulty = document.getElementById('sortDifficulty');
        const sortOptions = document.getElementById('sortOptions');
        const surpriseFilters = document.getElementById('surpriseFilters');
        const surpriseTags = document.querySelectorAll('.surprise-tag');

        // é‡ç½®æƒŠå–œæ ‡ç­¾é€‰ä¸­çŠ¶æ€
        surpriseTags.forEach(tag => tag.classList.remove('selected'));

        // ç§»é™¤æ‰€æœ‰æ¨¡å¼æ¿€æ´»çŠ¶æ€ï¼Œæ¿€æ´»å½“å‰æ¨¡å¼
        options.forEach(opt => opt.classList.remove('active'));
        document.querySelector(`.mode-option[onclick="switchMode('${currentMode}')"]`).classList.add('active');

        // åˆ‡æ¢æ»‘å—ä½ç½®å’Œæè¿°æ–‡æœ¬
        switch(currentMode) {
            case 'strict':
                slider.style.transform = 'translateX(0)';
                description.textContent = 'ä¸å°†å°±ï¼Œç¼ºä¸€ä¸å¯ï¼ˆæ‰€æœ‰èœè°±åŒ¹é…åº¦100%ï¼‰';
                // ç²¾å‡†æ¨¡å¼ï¼šç¦ç”¨åŒ¹é…åº¦æ’åºï¼Œä¿ç•™çƒ¹é¥ªæ—¶é—´å’Œéš¾åº¦ï¼Œéšè—æƒŠå–œæ ‡ç­¾
                sortMatch.classList.add('disabled');
                sortMatch.classList.remove('active');
                sortTime.classList.remove('disabled');
                sortDifficulty.classList.remove('disabled');
                sortOptions.style.display = 'flex';
                surpriseFilters.style.display = 'none';
                // ç¡®ä¿ç²¾å‡†æ¨¡å¼é»˜è®¤é€‰ä¸­çƒ¹é¥ªæ—¶é—´æˆ–éš¾åº¦
                if (!sortTime.classList.contains('active') && !sortDifficulty.classList.contains('active')) {
                    sortTime.classList.add('active');
                    currentSort = 'çƒ¹é¥ªæ—¶é—´';
                }
                break;
            case 'flexible':
                slider.style.transform = 'translateX(100%)';
                description.textContent = 'ç©ç‚¹èŠ±æ ·ï¼Œç¼ºä¸€ä¸¤æ ·ä¹Ÿè¡Œ';
                // åˆ›æ„æ¨¡å¼ï¼šå¯ç”¨æ‰€æœ‰æ’åºï¼Œéšè—æƒŠå–œæ ‡ç­¾
                sortMatch.classList.remove('disabled');
                sortTime.classList.remove('disabled');
                sortDifficulty.classList.remove('disabled');
                sortOptions.style.display = 'flex';
                surpriseFilters.style.display = 'none';
                // é»˜è®¤é€‰ä¸­åŒ¹é…åº¦
                if (!sortMatch.classList.contains('active')) {
                    sortMatch.classList.add('active');
                    sortTime.classList.remove('active');
                    sortDifficulty.classList.remove('active');
                    currentSort = 'åŒ¹é…åº¦';
                }
                break;
            case 'surprise':
                slider.style.transform = 'translateX(200%)';
                description.textContent = 'éšæœºæƒŠå–œï¼Œè§£é”æ–°å£å‘³';
                // æƒŠå–œæ¨¡å¼ï¼šéšè—åŸæ’åºé€‰é¡¹ï¼Œæ˜¾ç¤ºæƒŠå–œæ ‡ç­¾ç­›é€‰ï¼ˆç®€å•ç‚¹ã€å¿«é€Ÿã€é«˜åŒ¹é…ï¼‰
                sortOptions.style.display = 'none';
                surpriseFilters.style.display = 'flex';
                break;
        }
    }

    // åˆ‡æ¢åˆ†ç±»ç­›é€‰
    function toggleScenario(button) {
        document.querySelectorAll('.scenario-btn').forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');
        currentScenario = button.textContent;
        updateRecommendations();
    }

    // åˆ‡æ¢æƒŠå–œæ¨¡å¼æ ‡ç­¾ï¼ˆæ”¯æŒå¤šé€‰ï¼‰
    function toggleSurpriseTag(button) {
        const tagText = button.textContent;
        button.classList.toggle('selected');

        if (button.classList.contains('selected')) {
            // æ·»åŠ é€‰ä¸­çš„æ ‡ç­¾
            if (!selectedSurpriseTags.includes(tagText)) {
                selectedSurpriseTags.push(tagText);
            }
        } else {
            // ç§»é™¤é€‰ä¸­çš„æ ‡ç­¾
            selectedSurpriseTags = selectedSurpriseTags.filter(tag => tag !== tagText);
        }

        updateRecommendations();
    }

    // åˆ‡æ¢æ’åºæ–¹å¼ï¼ˆç²¾å‡†/åˆ›æ„æ¨¡å¼ç”¨ï¼‰
    function toggleSort(button) {
        // ç²¾å‡†æ¨¡å¼ä¸‹ä¸èƒ½é€‰æ‹©åŒ¹é…åº¦æ’åº
        if (currentMode === 'strict' && button.textContent === 'åŒ¹é…åº¦') {
            alert('ç²¾å‡†æ¨¡å¼ä¸‹æ‰€æœ‰èœè°±åŒ¹é…åº¦å‡ä¸º100%ï¼Œè¯·é€‰æ‹©çƒ¹é¥ªæ—¶é—´æˆ–éš¾åº¦æ’åº');
            return;
        }

        // ç§»é™¤æ‰€æœ‰æ’åºæ¿€æ´»çŠ¶æ€ï¼Œæ¿€æ´»å½“å‰æ’åº
        document.querySelectorAll('.sort-btn').forEach(btn => btn.classList.remove('active'));
        button.classList.add('active');
        currentSort = button.textContent;

        updateRecommendations();
    }

    // æ‰“å¼€èœè°±è¯¦æƒ…é¡µï¼ˆå’Œä¹‹å‰çš„é€»è¾‘ä¿æŒä¸€è‡´ï¼‰
    function openRecipeDetail(recipeName, event) {
        if (event) event.stopPropagation();
        // ç¼–ç èœè°±åç§°ï¼Œé¿å…URLç‰¹æ®Šå­—ç¬¦é—®é¢˜
        const encodedName = encodeURIComponent(recipeName);
        window.location.href = `æŸ¥çœ‹é£Ÿè°±.html?recipe=${encodedName}`;
    }

    // æƒŠå–œæ¨¡å¼éšæœºæ¨èï¼ˆå†…éƒ¨è°ƒç”¨ï¼Œæ”¯æŒæ ‡ç­¾ç­›é€‰ï¼‰
    function surpriseMeInternal() {
        const surpriseRecipes = [
            {name: 'éº»è¾£é¦™é”…', type: 'æ­£é¤', image: 'ğŸŒ¶ï¸ éº»è¾£é¦™é”…', tags: ['äº”èŠ±è‚‰', 'åœŸè±†', 'è—•ç‰‡'], time: '30åˆ†é’Ÿ', level: 'â­â­ ä¸­ç­‰', match: '100%'},
            {name: 'ç„¦ç³–å¸ƒä¸', type: 'ç”œç‚¹', image: 'ğŸ® ç„¦ç³–å¸ƒä¸', tags: ['é¸¡è›‹', 'ç‰›å¥¶', 'ç³–'], time: '40åˆ†é’Ÿ', level: 'â­â­ ä¸­ç­‰', match: '100%'},
            {name: 'è‘±æ²¹æ‹Œé¢', type: 'æ—©é¤', image: 'ğŸœ è‘±æ²¹æ‹Œé¢', tags: ['é¢æ¡', 'å°è‘±', 'é…±æ²¹'], time: '10åˆ†é’Ÿ', level: 'â­ ç®€å•', match: '100%'},
            {name: 'ç‰ç±³æ’éª¨æ±¤', type: 'æ±¤ç¾¹', image: 'ğŸ¥£ ç‰ç±³æ’éª¨æ±¤', tags: ['æ’éª¨', 'ç‰ç±³', 'èƒ¡èåœ'], time: '60åˆ†é’Ÿ', level: 'â­â­ ä¸­ç­‰', match: '100%'},
            {name: 'å’–å–±é¸¡å—', type: 'æ­£é¤', image: 'ğŸ› å’–å–±é¸¡å—', tags: ['é¸¡è‚‰', 'åœŸè±†', 'å’–å–±'], time: '25åˆ†é’Ÿ', level: 'â­â­ ä¸­ç­‰', match: '100%'},
            {name: 'æŠ¹èŒ¶å¤§ç¦', type: 'ç”œç‚¹', image: 'ğŸ¡ æŠ¹èŒ¶å¤§ç¦', tags: ['ç³¯ç±³ç²‰', 'æŠ¹èŒ¶', 'çº¢è±†æ²™'], time: '20åˆ†é’Ÿ', level: 'â­â­ ä¸­ç­‰', match: '100%'},
            {name: 'è”¬èœç²¥', type: 'æ—©é¤', image: 'ğŸ¥£ è”¬èœç²¥', tags: ['å¤§ç±³', 'é’èœ', 'èƒ¡èåœ'], time: '30åˆ†é’Ÿ', level: 'â­ ç®€å•', match: '100%'},
            {name: 'èŒè‡æ±¤', type: 'æ±¤ç¾¹', image: 'ğŸ„ èŒè‡æ±¤', tags: ['é¦™è‡', 'é‡‘é’ˆè‡', 'è±†è…'], time: '15åˆ†é’Ÿ', level: 'â­ ç®€å•', match: '100%'}
        ];

        // ç¬¬ä¸€æ­¥ï¼šæ ¹æ®åˆ†ç±»ç­›é€‰
        let filteredRecipes = surpriseRecipes;
        if (currentScenario !== 'å…¨éƒ¨') {
            filteredRecipes = surpriseRecipes.filter(recipe => recipe.type === currentScenario);
        }

        // ç¬¬äºŒæ­¥ï¼šæ ¹æ®æƒŠå–œæ ‡ç­¾ç­›é€‰
        if (selectedSurpriseTags.length > 0) {
            filteredRecipes = filteredRecipes.filter(recipe => {
                let matchAllTags = true;
                selectedSurpriseTags.forEach(tag => {
                    switch(tag) {
                        case 'ç®€å•ç‚¹':
                            if (recipe.level !== 'â­ ç®€å•') matchAllTags = false;
                            break;
                        case 'å¿«é€Ÿ':
                            if (parseInt(recipe.time) > 20) matchAllTags = false; // å¿«é€Ÿå®šä¹‰ä¸ºâ‰¤20åˆ†é’Ÿ
                            break;
                        case 'é«˜åŒ¹é…':
                            if (recipe.match !== '100%') matchAllTags = false;
                            break;
                    }
                });
                return matchAllTags;
            });
        }

        // æ— ç¬¦åˆæ¡ä»¶çš„èœè°±æ—¶è¿”å›é»˜è®¤
        if (filteredRecipes.length === 0) {
            filteredRecipes = surpriseRecipes.filter(recipe => recipe.type === currentScenario);
        }

        // éšæœºé€‰ä¸€ä¸ª
        return filteredRecipes[Math.floor(Math.random() * filteredRecipes.length)];
    }

    // æ›´æ–°æ¨èåˆ—è¡¨æ ¸å¿ƒå‡½æ•°
    function updateRecommendations() {
        const grid = document.getElementById('recommendationGrid');
        console.log('æ›´æ–°æ¨èç»“æœï¼š', {
            mode: currentMode,
            scenario: currentScenario,
            sort: currentSort,
            surpriseTags: selectedSurpriseTags
        });

        // æ ¹æ®ä¸åŒæ¨¡å¼ç”Ÿæˆæ¨èå†…å®¹
        switch(currentMode) {
            case 'strict':
                // ç²¾å‡†æ¨¡å¼ï¼šå…¨éƒ¨100%åŒ¹é…ï¼ŒæŒ‰åˆ†ç±»ç­›é€‰
                const strictRecipes = {
                    'å…¨éƒ¨': [
                        {name: 'ç•ªèŒ„ç‚’è›‹', type: 'æ­£é¤', image: 'ğŸ³ ç•ªèŒ„ç‚’è›‹', tags: ['ç•ªèŒ„', 'é¸¡è›‹', 'å°è‘±'], time: '15åˆ†é’Ÿ', level: 'â­ ç®€å•'},
                        {name: 'åœŸè±†ä¸ç‚’è‚‰', type: 'æ­£é¤', image: 'ğŸ¥” åœŸè±†ä¸ç‚’è‚‰', tags: ['åœŸè±†', 'çŒªè‚‰', 'è¾£æ¤’'], time: '20åˆ†é’Ÿ', level: 'â­ ç®€å•'},
                        {name: 'æ¸…ç‚’é¸¡èƒ¸è‚‰', type: 'æ­£é¤', image: 'ğŸ— æ¸…ç‚’é¸¡èƒ¸è‚‰', tags: ['é¸¡èƒ¸è‚‰', 'é’æ¤’', 'ç”Ÿå§œ'], time: '18åˆ†é’Ÿ', level: 'â­â­ ä¸­ç­‰'},
                        {name: 'ç„¦ç³–å¸ƒä¸', type: 'ç”œç‚¹', image: 'ğŸ® ç„¦ç³–å¸ƒä¸', tags: ['é¸¡è›‹', 'ç‰›å¥¶', 'ç³–'], time: '40åˆ†é’Ÿ', level: 'â­â­ ä¸­ç­‰'},
                        {name: 'è‘±æ²¹æ‹Œé¢', type: 'æ—©é¤', image: 'ğŸœ è‘±æ²¹æ‹Œé¢', tags: ['é¢æ¡', 'å°è‘±', 'é…±æ²¹'], time: '10åˆ†é’Ÿ', level: 'â­ ç®€å•'},
                        {name: 'ç‰ç±³æ’éª¨æ±¤', type: 'æ±¤ç¾¹', image: 'ğŸ¥£ ç‰ç±³æ’éª¨æ±¤', tags: ['æ’éª¨', 'ç‰ç±³', 'èƒ¡èåœ'], time: '60åˆ†é’Ÿ', level: 'â­â­ ä¸­ç­‰'}
                    ],
                    'æ­£é¤': [
                        {name: 'ç•ªèŒ„ç‚’è›‹', type: 'æ­£é¤', image: 'ğŸ³ ç•ªèŒ„ç‚’è›‹', tags: ['ç•ªèŒ„', 'é¸¡è›‹', 'å°è‘±'], time: '15åˆ†é’Ÿ', level: 'â­ ç®€å•'},
                        {name: 'åœŸè±†ä¸ç‚’è‚‰', type: 'æ­£é¤', image: 'ğŸ¥” åœŸè±†ä¸ç‚’è‚‰', tags: ['åœŸè±†', 'çŒªè‚‰', 'è¾£æ¤’'], time: '20åˆ†é’Ÿ', level: 'â­ ç®€å•'},
                        {name: 'æ¸…ç‚’é¸¡èƒ¸è‚‰', type: 'æ­£é¤', image: 'ğŸ— æ¸…ç‚’é¸¡èƒ¸è‚‰', tags: ['é¸¡èƒ¸è‚‰', 'é’æ¤’', 'ç”Ÿå§œ'], time: '18åˆ†é’Ÿ', level: 'â­â­ ä¸­ç­‰'}
                    ],
                    'ç”œç‚¹': [
                        {name: 'ç„¦ç³–å¸ƒä¸', type: 'ç”œç‚¹', image: 'ğŸ® ç„¦ç³–å¸ƒä¸', tags: ['é¸¡è›‹', 'ç‰›å¥¶', 'ç³–'], time: '40åˆ†é’Ÿ', level: 'â­â­ ä¸­ç­‰'},
                        {name: 'èŠ’æœç­æˆŸ', type: 'ç”œç‚¹', image: 'ğŸ¥­ èŠ’æœç­æˆŸ', tags: ['é¢ç²‰', 'èŠ’æœ', 'å¥¶æ²¹'], time: '30åˆ†é’Ÿ', level: 'â­â­ ä¸­ç­‰'}
                    ],
                    'æ—©é¤': [
                        {name: 'è‘±æ²¹æ‹Œé¢', type: 'æ—©é¤', image: 'ğŸœ è‘±æ²¹æ‹Œé¢', tags: ['é¢æ¡', 'å°è‘±', 'é…±æ²¹'], time: '10åˆ†é’Ÿ', level: 'â­ ç®€å•'},
                        {name: 'é¸¡è›‹çŒé¥¼', type: 'æ—©é¤', image: 'ğŸ¥ é¸¡è›‹çŒé¥¼', tags: ['é¢ç²‰', 'é¸¡è›‹', 'ç”Ÿèœ'], time: '15åˆ†é’Ÿ', level: 'â­ ç®€å•'}
                    ],
                    'æ±¤ç¾¹': [
                        {name: 'ç‰ç±³æ’éª¨æ±¤', type: 'æ±¤ç¾¹', image: 'ğŸ¥£ ç‰ç±³æ’éª¨æ±¤', tags: ['æ’éª¨', 'ç‰ç±³', 'èƒ¡èåœ'], time: '60åˆ†é’Ÿ', level: 'â­â­ ä¸­ç­‰'},
                        {name: 'èŒè‡æ±¤', type: 'æ±¤ç¾¹', image: 'ğŸ„ èŒè‡æ±¤', tags: ['é¦™è‡', 'é‡‘é’ˆè‡', 'è±†è…'], time: '15åˆ†é’Ÿ', level: 'â­ ç®€å•'}
                    ]
                };

                // è·å–å½“å‰åˆ†ç±»çš„èœè°±å¹¶æ’åº
                let strictList = strictRecipes[currentScenario];
                if (currentSort === 'çƒ¹é¥ªæ—¶é—´') {
                    // æŒ‰æ—¶é—´å‡åºæ’åº
                    strictList.sort((a, b) => {
                        const timeA = parseInt(a.time);
                        const timeB = parseInt(b.time);
                        return timeA - timeB;
                    });
                } else if (currentSort === 'éš¾åº¦') {
                    // æŒ‰éš¾åº¦æ’åºï¼ˆç®€å• < ä¸­ç­‰ < å›°éš¾ï¼‰
                    const levelMap = {'â­ ç®€å•': 1, 'â­â­ ä¸­ç­‰': 2, 'â­â­â­ å›°éš¾': 3};
                    strictList.sort((a, b) => levelMap[a.level] - levelMap[b.level]);
                }

                // ç”ŸæˆHTMLï¼ˆæ·»åŠ åˆ†ç±»æ ‡ç­¾+æŸ¥çœ‹èœè°±æŒ‰é’®ï¼‰
                grid.innerHTML = strictList.map(recipe => `
                    <div class="recipe-card" onclick="openRecipeDetail('${recipe.name}')">
                        <div class="match-badge perfect-match">100%åŒ¹é…</div>
                        <div class="recipe-image">${recipe.image}</div>
                        <div class="recipe-content">
                            <div class="recipe-title">${recipe.name} <span class="category-tag">${recipe.type}</span></div>
                            <div class="recipe-tags">
                                ${recipe.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                            </div>
                            <div class="recipe-meta">
                                <span>â±ï¸ ${recipe.time}</span>
                                <span>${recipe.level}</span>
                            </div>
                            <button class="view-btn" onclick="openRecipeDetail('${recipe.name}', event)">æŸ¥çœ‹èœè°±</button>
                        </div>
                    </div>
                `).join('');
                break;

            case 'flexible':
                // åˆ›æ„æ¨¡å¼ï¼šåŒ…å«éƒ¨åˆ†åŒ¹é…ï¼ŒæŒ‰åˆ†ç±»ç­›é€‰
                const flexibleRecipes = {
                    'å…¨éƒ¨': [
                        {name: 'ç´«èœè›‹èŠ±æ±¤', type: 'æ±¤ç¾¹', image: 'ğŸ² ç´«èœè›‹èŠ±æ±¤', tags: ['ç´«èœ', 'é¸¡è›‹'], time: '10åˆ†é’Ÿ', level: 'â­ ç®€å•', match: '90%', missing: ['é¦™æ²¹']},
                        {name: 'çº¢çƒ§è‚‰', type: 'æ­£é¤', image: 'ğŸ– çº¢çƒ§è‚‰', tags: ['äº”èŠ±è‚‰', 'å†°ç³–'], time: '60åˆ†é’Ÿ', level: 'â­â­ ä¸­ç­‰', match: '80%', missing: ['ç”Ÿå§œ', 'æ–™é…’']},
                        {name: 'æŠ¹èŒ¶è›‹ç³•', type: 'ç”œç‚¹', image: 'ğŸ° æŠ¹èŒ¶è›‹ç³•', tags: ['é¢ç²‰', 'é¸¡è›‹'], time: '50åˆ†é’Ÿ', level: 'â­â­â­ å›°éš¾', match: '70%', missing: ['æŠ¹èŒ¶ç²‰', 'å¥¶æ²¹']},
                        {name: 'çš®è›‹ç˜¦è‚‰ç²¥', type: 'æ—©é¤', image: 'ğŸ¥£ çš®è›‹ç˜¦è‚‰ç²¥', tags: ['å¤§ç±³', 'çŒªè‚‰'], time: '40åˆ†é’Ÿ', level: 'â­ ç®€å•', match: '85%', missing: ['çš®è›‹']}
                    ],
                    'æ­£é¤': [
                        {name: 'çº¢çƒ§è‚‰', type: 'æ­£é¤', image: 'ğŸ– çº¢çƒ§è‚‰', tags: ['äº”èŠ±è‚‰', 'å†°ç³–'], time: '60åˆ†é’Ÿ', level: 'â­â­ ä¸­ç­‰', match: '80%', missing: ['ç”Ÿå§œ', 'æ–™é…’']},
                        {name: 'é’æ¤’ç‚’è‚‰', type: 'æ­£é¤', image: 'ğŸŒ¶ï¸ é’æ¤’ç‚’è‚‰', tags: ['çŒªè‚‰', 'é’æ¤’'], time: '20åˆ†é’Ÿ', level: 'â­ ç®€å•', match: '90%', missing: ['å¤§è’œ']}
                    ],
                    'ç”œç‚¹': [
                        {name: 'ç„¦ç³–å¸ƒä¸', type: 'ç”œç‚¹', image: 'ğŸ® ç„¦ç³–å¸ƒä¸', tags: ['é¸¡è›‹', 'ç‰›å¥¶'], time: '40åˆ†é’Ÿ', level: 'â­â­ ä¸­ç­‰', match: '95%', missing: ['ç³–']},
                        {name: 'æŠ¹èŒ¶è›‹ç³•', type: 'ç”œç‚¹', image: 'ğŸ° æŠ¹èŒ¶è›‹ç³•', tags: ['é¢ç²‰', 'é¸¡è›‹'], time: '50åˆ†é’Ÿ', level: 'â­â­â­ å›°éš¾', match: '70%', missing: ['æŠ¹èŒ¶ç²‰', 'å¥¶æ²¹']}
                    ],
                    'æ—©é¤': [
                        {name: 'è‘±æ²¹æ‹Œé¢', type: 'æ—©é¤', image: 'ğŸœ è‘±æ²¹æ‹Œé¢', tags: ['é¢æ¡'], time: '10åˆ†é’Ÿ', level: 'â­ ç®€å•', match: '80%', missing: ['å°è‘±', 'é…±æ²¹']},
                        {name: 'çš®è›‹ç˜¦è‚‰ç²¥', type: 'æ—©é¤', image: 'ğŸ¥£ çš®è›‹ç˜¦è‚‰ç²¥', tags: ['å¤§ç±³', 'çŒªè‚‰'], time: '40åˆ†é’Ÿ', level: 'â­ ç®€å•', match: '85%', missing: ['çš®è›‹']}
                    ],
                    'æ±¤ç¾¹': [
                        {name: 'ç´«èœè›‹èŠ±æ±¤', type: 'æ±¤ç¾¹', image: 'ğŸ² ç´«èœè›‹èŠ±æ±¤', tags: ['ç´«èœ', 'é¸¡è›‹'], time: '10åˆ†é’Ÿ', level: 'â­ ç®€å•', match: '90%', missing: ['é¦™æ²¹']},
                        {name: 'å†¬ç“œä¸¸å­æ±¤', type: 'æ±¤ç¾¹', image: 'ğŸ¥£ å†¬ç“œä¸¸å­æ±¤', tags: ['çŒªè‚‰'], time: '25åˆ†é’Ÿ', level: 'â­ ç®€å•', match: '75%', missing: ['å†¬ç“œ', 'æ·€ç²‰']}
                    ]
                };

                // è·å–å½“å‰åˆ†ç±»çš„èœè°±å¹¶æ’åº
                let flexibleList = flexibleRecipes[currentScenario];
                if (currentSort === 'åŒ¹é…åº¦') {
                    // æŒ‰åŒ¹é…åº¦é™åº
                    flexibleList.sort((a, b) => parseFloat(b.match) - parseFloat(a.match));
                } else if (currentSort === 'çƒ¹é¥ªæ—¶é—´') {
                    // æŒ‰æ—¶é—´å‡åº
                    flexibleList.sort((a, b) => parseInt(a.time) - parseInt(b.time));
                } else if (currentSort === 'éš¾åº¦') {
                    const levelMap = {'â­ ç®€å•': 1, 'â­â­ ä¸­ç­‰': 2, 'â­â­â­ å›°éš¾': 3};
                    flexibleList.sort((a, b) => levelMap[a.level] - levelMap[b.level]);
                }

                // ç”ŸæˆHTMLï¼ˆåŒ…å«ç¼ºå¤±é£Ÿæå±•ç¤º+åˆ†ç±»æ ‡ç­¾+æŸ¥çœ‹èœè°±æŒ‰é’®ï¼‰
                grid.innerHTML = flexibleList.map(recipe => `
                    <div class="recipe-card" onclick="openRecipeDetail('${recipe.name}')">
                        <div class="match-badge ${recipe.match === '100%' ? 'perfect-match' : 'partial-match'}">
                            ${recipe.match === '100%' ? '100%åŒ¹é…' : `ç¼º${recipe.missing.length}æ ·`}
                        </div>
                        <div class="recipe-image">${recipe.image}</div>
                        <div class="recipe-content">
                            <div class="recipe-title">${recipe.name} <span class="category-tag">${recipe.type}</span></div>
                            <div class="recipe-tags">
                                ${recipe.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                            </div>
                            ${recipe.missing.length > 0 ? `
                                <div class="missing-ingredients">
                                    <div class="title">ç¼ºå°‘é£Ÿæï¼š</div>
                                    <div class="missing-list">
                                        ${recipe.missing.map(item => `<span class="missing-tag">${item}</span>`).join('')}
                                    </div>
                                </div>
                            ` : ''}
                            <div class="recipe-meta">
                                <span>â±ï¸ ${recipe.time}</span>
                                <span>${recipe.level}</span>
                            </div>
                            <button class="view-btn" onclick="openRecipeDetail('${recipe.name}', event)">æŸ¥çœ‹èœè°±</button>
                        </div>
                    </div>
                `).join('');
                break;

            case 'surprise':
                // æƒŠå–œæ¨¡å¼ï¼šéšæœºæ¨èä¸€ä¸ªç¬¦åˆåˆ†ç±»+æ ‡ç­¾çš„èœè°±
                const surpriseRecipe = surpriseMeInternal();
                grid.innerHTML = `
                    <div class="recipe-card" onclick="openRecipeDetail('${surpriseRecipe.name}')">
                        <div class="match-badge surprise-match">æƒŠå–œæ¨è</div>
                        <div class="recipe-image">${surpriseRecipe.image}</div>
                        <div class="recipe-content">
                            <div class="recipe-title">${surpriseRecipe.name} <span class="category-tag">${surpriseRecipe.type}</span></div>
                            <div class="recipe-tags">
                                ${surpriseRecipe.tags.map(tag => `<span class="tag">${tag}</span>`).join('')}
                            </div>
                            <div class="recipe-meta">
                                <span>â±ï¸ ${surpriseRecipe.time}</span>
                                <span>${surpriseRecipe.level}</span>
                            </div>
                            <button class="view-btn" onclick="openRecipeDetail('${surpriseRecipe.name}', event)">æŸ¥çœ‹èœè°±</button>
                        </div>
                    </div>
                `;
                break;
        }
    }

    // åˆå§‹åŒ–æ¨èå†…å®¹
    updateRecommendations();
</script>
</body>
</html>